<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Luna Chat</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      background-image: url("assets/imagens/luna/fundo.jpg");
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      color: #fff;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
    }

    /* LOGIN */
    .login-container {
      width: 320px;
      background-color: rgba(42, 42, 61, 0.95);
      border-radius: 12px;
      padding: 15px;
      box-shadow: 0 0 20px rgba(0,0,0,0.6);
      text-align: center;
    }

    .login-container input {
      width: 100%;
      padding: 9px;
      border-radius: 6px;
      border: none;
      margin-bottom: 8px;
    }

    .login-container button {
      width: 100%;
      padding: 9px;
      border-radius: 6px;
      border: none;
      background-color: #ffcc66;
      font-weight: bold;
      cursor: pointer;
    }

    .erro {
      color: #ff6b6b;
      font-size: 0.9em;
    }

    /* CHAT (seu cÃ³digo original) */
    .chat-container {
      display: none;
      width: 360px;
      max-width: 95%;
      background-color: rgba(42, 42, 61, 0.92);
      border-radius: 12px;
      padding: 10px;
      flex-direction: column;
      height: 540px;
      box-shadow: 0 0 20px rgba(0,0,0,0.6);
    }

    .avatar {
      display: flex;
      justify-content: center;
      margin-bottom: 6px;
    }

    .avatar img {
      width: 90px;
      height: 90px;
      border-radius: 50%;
      border: 3px solid #ffcc66;
      object-fit: cover;
    }

    .chat-window {
      flex: 1;
      overflow-y: auto;
      padding: 8px;
      border-radius: 6px;
      background-color: #1f1f2d;
      margin-bottom: 6px;
    }

    .message {
      margin: 6px 0;
      line-height: 1.4;
    }

    .user { color: #9acdff; }
    .luna { color: #ffcc66; }

    input {
      width: 100%;
      padding: 9px;
      border-radius: 6px;
      border: none;
      outline: none;
      margin-bottom: 6px;
    }

    .buttons {
      display: flex;
      gap: 6px;
    }

    button {
      flex: 1;
      padding: 9px;
      border: none;
      border-radius: 6px;
      background-color: #ffcc66;
      font-weight: bold;
      cursor: pointer;
    }

    button:hover {
      background-color: #e6b24d;
    }

    .mic {
      background-color: #6cf;
    }
  </style>
</head>

<body>

<!-- LOGIN -->
<div class="login-container" id="loginBox">
  <h3>ðŸ”’ Acesso Luna</h3>
  <input type="password" id="senha" placeholder="Digite a senha">
  <button onclick="login()">Entrar</button>
  <div class="erro" id="erro"></div>
</div>

<!-- CHAT -->
<div class="chat-container" id="chatBox">

  <div class="avatar">
    <img src="assets/imagens/luna/logoluna.jpg" alt="Luna">
  </div>

  <div class="chat-window" id="chatWindow"></div>

  <input type="text" id="userInput" placeholder="Escreva ou fale algo...">

  <div class="buttons">
    <button onclick="enviar()">Enviar</button>
    <button class="mic" onclick="ouvir()">ðŸŽ¤</button>
  </div>

</div>

<script>
  const CHAT_PASSWORD = "1234"; // ðŸ”‘ MUDE AQUI
  const API_URL = "https://luna-ad4s.onrender.com/chat";

  const loginBox = document.getElementById("loginBox");
  const chatBox = document.getElementById("chatBox");
  const erro = document.getElementById("erro");

  function login() {
    if (document.getElementById("senha").value === CHAT_PASSWORD) {
      loginBox.style.display = "none";
      chatBox.style.display = "flex";
    } else {
      erro.textContent = "Senha incorreta";
    }
  }

  const chatWindow = document.getElementById("chatWindow");
  const userInput = document.getElementById("userInput");

  let vozSelecionada = null;

  function addMessage(text, sender) {
    const div = document.createElement("div");
    div.className = "message " + sender;
    div.textContent = text;
    chatWindow.appendChild(div);
    chatWindow.scrollTop = chatWindow.scrollHeight;
  }

  function removerEmojis(texto) {
    return texto.replace(/[\p{Emoji_Presentation}\p{Extended_Pictographic}]/gu,"").trim();
  }

  function carregarVozes() {
    const vozes = speechSynthesis.getVoices();
    vozSelecionada = vozes.find(v => v.lang === "pt-BR") || vozes[0];
  }

  speechSynthesis.onvoiceschanged = carregarVozes;

  function falar(texto) {
    if (!vozSelecionada) carregarVozes();
    const fala = new SpeechSynthesisUtterance(removerEmojis(texto));
    fala.lang = "pt-BR";
    fala.pitch = 1.2;
    speechSynthesis.cancel();
    speechSynthesis.speak(fala);
  }

  async function enviar() {
    const pergunta = userInput.value.trim();
    if (!pergunta) return;

    addMessage("VocÃª: " + pergunta, "user");
    userInput.value = "";

    try {
      const response = await fetch(API_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ message: pergunta })
      });

      const data = await response.json();
      const resposta = data.response || "NÃ£o entendi.";
      addMessage("Luna: " + resposta, "luna");
      falar(resposta);

    } catch {
      addMessage("Luna: Erro de conexÃ£o ðŸ˜¢", "luna");
    }
  }

  function ouvir() {
    if (!("webkitSpeechRecognition" in window)) {
      alert("Reconhecimento de voz nÃ£o suportado.");
      return;
    }

    const r = new webkitSpeechRecognition();
    r.lang = "pt-BR";
    r.start();
    r.onresult = e => {
      userInput.value = e.results[0][0].transcript;
      enviar();
    };
  }

  userInput.addEventListener("keydown", e => {
    if (e.key === "Enter") enviar();
  });
</script>

</body>
</html>
